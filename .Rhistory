#                         se = FALSE,
#                         conf = 0.95)
#
# saveRDS(inextSample18S, "./data/Data/SAMPrarecurveiNEXT18S.rds")
inextSample18S <- readRDS("./data/Data/SAMPrarecurveiNEXT18S.rds")
plotdf18Ssamp <- inextSample18S$iNextEst$size_based %>% mutate(m = m/10000,
qD = qD/1000)  %>%
filter(Order.q == 0) %>%
left_join(., metadata %>% rownames_to_column(var = "Assemblage"), by = "Assemblage" )
observed18Ssamp <- plotdf18Ssamp %>% filter(Method == "Observed")
extrapolate18Ssamp <- plotdf18Ssamp %>% filter(Method == "Extrapolation")
plotdf18Ssamp %>%
filter(Method == "Rarefaction") %>%
ggplot(aes(x = m, y = qD, group = Assemblage, color=ROV)) +
geom_line(color = "grey", size = 0.10, linetype="solid") +
geom_line(data = extrapolate18Ssamp, aes(x = m, y=qD, group=Assemblage, color = ROV),
size = 0.50, linetype="solid", color="red") +
geom_point(data = observed18Ssamp, aes(x = m, y = qD), size =1,
color = "blue") +
theme_bw() +
theme(axis.text =  element_text(size = 10),
axis.title.x = element_text(size = 12, vjust = -2),
axis.title.y = element_text(size = 12, vjust= 4),
plot.title = element_text(size = 12, face = "italic"),
legend.text =   element_text(size = 9),
# legend.title =   element_text(size = 9),
legend.background = element_blank(),
plot.background = element_blank(),
panel.background = element_blank(),
panel.border =element_rect(colour="black", size = 1.3),
panel.grid = element_line(color = "grey95"),
plot.margin = margin(0.5,0.5,0.5,0.5, "cm"),
legend.position = c(0.87,0.84),
legend.title = element_blank()) +
scale_color_brewer(palette="Set1") +
expand_limits(x=c(0,15)) +
xlab("Sequence Sampled (x10,000)") +
ylab("Richness (x1000)") +
ggtitle("Fungal 18S Diversity")
ggsave("./data/graphs/supplementary/FigS3_3alphadiversity.png",
width = 15,
height = 13,
units = "cm",
dpi = 300 )
plotdf18Ssamp %>%
filter(Method == "Rarefaction") %>%
ggplot(aes(x = m, y = SC, group = Assemblage)) +
geom_line(color = "grey", size = 0.10, linetype="solid") +
geom_line(data = extrapolate18Ssamp, aes(x = m, y=SC, group=Assemblage),
size = 0.50, linetype="solid", color = "red") +
geom_point(data = observed18Ssamp, aes(x = m, y = SC), size =1,
color = "blue") +
theme_bw() +
theme(axis.text =  element_text(size = 10),
axis.title.x = element_text(size = 12, vjust = -2),
axis.title.y = element_text(size = 12, vjust= 4),
plot.title = element_text(size = 12, face = "italic"),
legend.text =   element_text(size = 9),
legend.title =   element_text(size = 9),
legend.background = element_blank(),
plot.background = element_blank(),
panel.background = element_blank(),
panel.border =element_rect(colour="black", size = 1.3),
panel.grid = element_line(color = "grey95"),
plot.margin = margin(0.5,0.5,0.5,0.5, "cm"),
legend.position = "none") +
xlab("Sequence Sampled (x10,000)") +
ylab("Proportion ASV Coverage") +
ggtitle("Fungal 18S Diversity")
ggsave("./data/graphs/supplementary/FigS4_3alphadiversity.png",
width = 15,
height = 13,
units = "cm",
dpi = 300 )
#### ALPHA DIVERSITY CORRELATION ####
numericdf <- observed18Ssamp %>%
select_if(is.numeric) %>%
select_if(~sum(!is.na(.x)) > 0) %>%
select(-Order.q, -m, -SC) %>%
dplyr::rename(Richness=qD) %>%
drop_na()
corrdf <- cor(numericdf)
myfunc <- function(i,j) mapply(function(a,b) cor.test(mtcars[[a]], mtcars[[b]])$p.value, i, j)
pvaldf <- outer(numericdf, numericdf, Vectorize(function(a, b) cor.test(a, b)$p.value))
View(plotdf18Ssamp)
View(plotdf18Ssamp)
View(plotdf18S)
View(plotdf18Ssamp)
#### ALPHA DIVERSITY CORRELATION ####
minseq <- observed18Ssamp %>% pull(q)
observed18Ssamp
observed18Ssamp
#### ALPHA DIVERSITY CORRELATION ####
minseq <- observed18Ssamp %>% pull(m)
minseq
#### ALPHA DIVERSITY CORRELATION ####
minseq <- observed18Ssamp %>% pull(m) %>% min()
minseq
plotdf18Ssamp
minseq
numericdf <- plotdf18Ssamp %>%
select_if(is.numeric) %>%
select_if(~sum(!is.na(.x)) > 0)
View(numericdf)
numericdf <- plotdf18Ssamp %>%
select_if(is.numeric) %>%
select_if(~sum(!is.na(.x)) > 0) %>%
filter(m = minseq)
numericdf <- plotdf18Ssamp %>%
select_if(is.numeric) %>%
select_if(~sum(!is.na(.x)) > 0) %>%
filter(m ==minseq)
View(numericdf)
minseq
library(phyloseq)
library(tidyverse)
library(ggtree)
library(ggtreeExtra)
library(tidytree)
library(microbiome)
physeq <- readRDS("./data/Data/physeq18SFungi.rds")
taxtable <- data.frame(tax_table(physeq))
#### CLEAN PHY TREE ####
physeqmerge <- microbiome::transform(merge_samples(tax_glom(physeq, "Phylum"), "ROV"), "clr")
taxdf <- data.frame(tax_table(physeqmerge))
otumerge <- data.frame(otu_table(physeqmerge)) %>%
mutate_all(as.numeric) %>% t() %>%
as.data.frame() %>% rownames_to_column(var="SampleID") %>%
mutate(SampleID = gsub("X", "", SampleID)) %>%
merge((taxdf %>% rownames_to_column("SampleID") %>% select(Phylum, SampleID)),
by="SampleID") %>%
rename(ID=SampleID)
treephylum <- phyloseq::phy_tree(physeqmerge)
tree <- ggtree(treephylum,
size=0.5,
ladderize = TRUE)
otumergeheat <- otumerge %>% pivot_longer(c(ROV1, ROV2, ROV3, ROV5),
names_to = "ROV",
values_to = "Abund") %>%
select(-Phylum)
treephyldf <- otumerge %>% select(ID, Phylum)
abundtab <- otumergeheat %>%
group_by(ID) %>%
mutate(sd= sd(Abund)) %>%
group_by(ID, ROV) %>%
summarize(meanAbund = mean(Abund),
sd = sd)%>%
merge(., taxdf %>%
rownames_to_column("ID"), by="ID")
# taxdf["8026cec509b8e367afc55e8425d92c24", ]
# join tree & metadata
tree %<+% treephyldf +
geom_tiplab(aes(label=Phylum),
size=2.5,
hjust=-0.1,
fontface="bold.italic") +
geom_fruit(
data=otumergeheat,
geom=geom_tile,
mapping=aes(x=ROV, y=ID, alpha=Abund),
fill="green3",
color="white",
pwidth=0.9,
offset=1.1,
axis.params = list(axis = "x", text.angle = 90,
text.size = 2,
text.color ="green",
hjust =-14.5,
title = NULL,
line.alpha = 0)
) +
scale_color_brewer(palette="Set1") +
scale_fill_brewer(palette="Set1") +
theme(legend.text=element_text(size = 6, face="bold"),
legend.background=element_blank(),
legend.title=element_text(size=8, face="bold"),
legend.position = "right",
panel.background=element_blank(),
plot.background=element_blank()) +
scale_y_continuous(expand=c(0,3)) +
labs(alpha='CLR \nAbundance\n') +
scale_alpha_continuous(range=c(0.0,1))
physeqmerge <- microbiome::transform(merge_samples(tax_glom(physeq, "Phylum"), "ROV"), "compostion")
?microbiome::transform
physeqmerge <- microbiome::transform(merge_samples(tax_glom(physeq, "Phylum"), "ROV"), "compositional")
taxdf <- data.frame(tax_table(physeqmerge))
otumerge <- data.frame(otu_table(physeqmerge)) %>%
mutate_all(as.numeric) %>% t() %>%
as.data.frame() %>% rownames_to_column(var="SampleID") %>%
mutate(SampleID = gsub("X", "", SampleID)) %>%
merge((taxdf %>% rownames_to_column("SampleID") %>% select(Phylum, SampleID)),
by="SampleID") %>%
rename(ID=SampleID)
treephylum <- phyloseq::phy_tree(physeqmerge)
tree <- ggtree(treephylum,
size=0.5,
ladderize = TRUE)
otumergeheat <- otumerge %>% pivot_longer(c(ROV1, ROV2, ROV3, ROV5),
names_to = "ROV",
values_to = "Abund") %>%
select(-Phylum)
treephyldf <- otumerge %>% select(ID, Phylum)
abundtab <- otumergeheat %>%
group_by(ID) %>%
mutate(sd= sd(Abund)) %>%
group_by(ID, ROV) %>%
summarize(meanAbund = mean(Abund),
sd = sd)%>%
merge(., taxdf %>%
rownames_to_column("ID"), by="ID")
tree %<+% treephyldf +
geom_tiplab(aes(label=Phylum),
size=2.5,
hjust=-0.1,
fontface="bold.italic") +
geom_fruit(
data=otumergeheat,
geom=geom_tile,
mapping=aes(x=ROV, y=ID, alpha=Abund),
fill="green3",
color="white",
pwidth=0.9,
offset=1.1,
axis.params = list(axis = "x", text.angle = 90,
text.size = 2,
text.color ="green",
hjust =-14.5,
title = NULL,
line.alpha = 0)
) +
scale_color_brewer(palette="Set1") +
scale_fill_brewer(palette="Set1") +
theme(legend.text=element_text(size = 6, face="bold"),
legend.background=element_blank(),
legend.title=element_text(size=8, face="bold"),
legend.position = "right",
panel.background=element_blank(),
plot.background=element_blank()) +
scale_y_continuous(expand=c(0,3)) +
labs(alpha='CLR \nAbundance\n') +
scale_alpha_continuous(range=c(0.0,1))
tree %<+% treephyldf +
geom_tiplab(aes(label=Phylum),
size=2.5,
hjust=-0.1,
fontface="bold.italic") +
geom_fruit(
data=otumergeheat,
geom=geom_tile,
mapping=aes(x=ROV, y=ID, alpha=Abund),
fill="green3",
color="white",
pwidth=0.9,
offset=1.1,
axis.params = list(axis = "x", text.angle = 90,
text.size = 2,
text.color ="green",
hjust =-14.5,
title = NULL,
line.alpha = 0)
) +
scale_color_brewer(palette="Set1") +
scale_fill_brewer(palette="Set1") +
theme(legend.text=element_text(size = 6, face="bold"),
legend.background=element_blank(),
legend.title=element_text(size=8, face="bold"),
legend.position = "right",
panel.background=element_blank(),
plot.background=element_blank()) +
scale_y_continuous(expand=c(0,3)) +
labs(alpha='Relative \nAbundance\n') +
scale_alpha_continuous(range=c(0.0,1))
ggsave("./data/graphs/supplementary/FigS1_19phylumtree.tiff",
width = 10,
height = 11.7,
units = "cm",
dpi = 1000 )
View(taxdf)
renv::isolate()
renv::snapshot()
.libPaths()
renv:isolate()
isolate()
renv::isolate()
renv::snapshot()
renv::install("BiocVersion")
renv::install()
renv:init()
renv::init()
renvt::init()
renv::init()
renv::status()
renv::snapshot()
renv:install.packages("ggven")
renv::install("ggven")
devtools::install_github("yanlinlin82/ggvenn")
renv::snp
renv::snapshot()
BiocManager::install(version = "3.14")
renv::snapshot()
BiocManager::available()
.libPaths()
fs::dir_tree(path = "/Library/Frameworks/R.framework/Versions", recurse = FALSE)
renv::init()
BiocManager::install("phyloseq")
install.packages("BiocManager")
renv::isolate()
BiocManager::install("phyloseq")
renvt::init()
renv::init()
.libPaths()
library(phyloseq)
library(tidyverse)
library(data.table)
library(ape)
library(phyloseq)
library(tidyverse)
library(vegan)
library(ggplot2)
library(iNEXT)
library(corrplot)
library(PerformanceAnalytics)
library(GGally)
library(phyloseq)
library(tidyverse)
library(phyloseq)
library(tidyverse)
library(metagMisc)
renv::install("metagMisc")
remotes::install_github("vmikk/metagMisc")
install.packages("remotes")
remotes::install_github("vmikk/metagMisc")
remotes::install_github("vmikk/metagMisc")
devtools::install_github("vmikk/metagMisc")
renv::install("vmikk/metagMisc")
library(phyloseq)
library(tidyverse)
library(metagMisc)
library(phyloseq)
library(SpiecEasi)
library(tidyverse)
library(igraph)
library(ggpubr)
library(gridExtra)
# libraries
library(ggplot2)
library(igraph)
library(ggsignif)
library(tidyverse)
library(rlist)
library(ggpubr)
library(tidyverse)
library(phyloseq)
library(igraph)
library(ggridges)
library('brainGraph')
library(tidyverse)
library(phyloseq)
library(igraph)
library(brainGraph)
library(binr)
library(ggpubr)
library(RColorBrewer)
library(tidyverse)
library(phyloseq)
library(igraph)
library(brainGraph)
library(binr)
library(ggrepel)
library(tidyverse)
library(phyloseq)
library(igraph)
set.seed(123)
library(phyloseq)
library(tidyverse)
library(RColorBrewer)
set.seed(1234)
library(plyr)
library(tidyverse)
library(dplyr)
library(phyloseq)
library(lefser)
library(mia)
library(RColorBrewer)
renv::install("lefser")
renv::install("bioc::lefser")
renv::install("bioc::mia")
# make input for LEFSE
SExp <- makeTreeSummarizedExperimentFromPhyloseq(physeq18SFungi)
### LOAD DATA
physeq18SFungi <- readRDS("./data/Data/physeq18SFungi.rds")
sampdata <- data.frame(sample_data(physeq18SFungi)) %>%
mutate(Seep = if_else(ROV=="ROV5", "Control", "Seep"))
sample_data(physeq18SFungi) <- sampdata
taxdf <- data.frame(tax_table(physeq18SFungi))
# make input for LEFSE
SExp <- makeTreeSummarizedExperimentFromPhyloseq(physeq18SFungi)
library(lefser)
library(mia)
library(RColorBrewer)
# make input for LEFSE
SExp <- makeTreeSummarizedExperimentFromPhyloseq(physeq18SFungi)
?renv::isolate
library(phyloseq)
library(SpiecEasi)
library(tidyverse)
library(ggpubr)
library(corrplot)
renv::install("zdk123/SpiecEasi")
library(devtools)
install.packages(devtools)
renv::install("zdk123/SpiecEasi")
renv::install("devtools")
library(devtools)
devtools::install_github("zdk123/SpiecEasi")
library(phyloseq)
library(SpiecEasi)
library(tidyverse)
library(ggpubr)
library(corrplot)
library(devtools)
devtools::install_github("zdk123/SpiecEasi")
install_github("zdk123/pulsar")
devtools::install_github("zdk123/SpiecEasi")
library(phyloseq)
library(SpiecEasi)
library(tidyverse)
library(ggpubr)
library(corrplot)
library(devtools)
library(tidyverse)
library(ggVennDiagram)
library(ggven)
library(RColorBrewer)
physeq18SFungi <- readRDS("./data/Data/physeq18SFungi.rds")
physeqfilt <- merge_samples(physeq18SFungi, "ROV")
otudf <- data.frame(otu_table(physeqfilt)) %>% t() %>% data.frame()
taxdf <- data.frame(tax_table(physeqfilt))
sampdf <- data.frame(sample_data(physeqfilt))
x <- list(
ROV1 = otudf$ROV1[otudf$ROV1>5],
ROV2 = otudf$ROV2[otudf$ROV2>5],
ROV3 = otudf$ROV3[otudf$ROV3>5],
ROV5 = otudf$ROV5[otudf$ROV5>5]
)
venn <- Venn(x)
data <- process_data(venn)
ggplot() +
geom_sf(aes(alpha=count), data = venn_region(data), fill="skyblue") +
geom_sf(aes(color=name), size = 0.8, lty = "solid",
data = venn_setedge(data), show.legend = F) +
geom_sf_text(aes(label = name, color=name), data = venn_setlabel(data), size=3,
fontface="bold", vjust=-0.5) +
geom_sf_text(aes(label=paste0(signif(count*100/sum(count),2), "%")),
fontface = "italic", data = venn_region(data),
size=3) +
geom_sf_text(aes(label=count),
fontface = "italic", data = venn_region(data),
vjust=-1, size=3) +
theme_void() +
scale_color_brewer(palette="Set1") +
scale_y_continuous(expand=c(0,0.1)) +
scale_x_continuous(expand=c(0,0.1)) +
theme(legend.position = "none",
plot.margin = margin(0,0,0,0, unit="cm"),
plot.title = element_text(hjust = 0.5, vjust=5, face="italic",
color="grey40", size=12)) #+  ggtitle(label="Shared Fungal ASVs")
ggplot() +
geom_sf(aes(alpha=count), data = venn_region(data), fill="skyblue") +
geom_sf(aes(color=name), size = 0.8, lty = "solid",
data = venn_setedge(data), show.legend = F) +
geom_sf_text(aes(label = name, color=name), data = venn_setlabel(data), size=3,
fontface="bold", vjust=-0.5) +
geom_sf_text(aes(label=paste0(signif(count*100/sum(count),2), "%")),
fontface = "italic", data = venn_region(data),
size=3) +
geom_sf_text(aes(label=count),
fontface = "italic", data = venn_region(data),
vjust=-1, size=3) +
theme_void() +
scale_color_brewer(palette="Set1") +
scale_y_continuous(expand=c(0,0.1)) +
scale_x_continuous(expand=c(0,0.1)) +
theme(legend.position = "none",
plot.margin = margin(0,0,0,0, unit="cm"),
plot.title = element_text(hjust = 0.5, vjust=5, face="italic",
color="grey40", size=12)) #+  ggtitle(label="Shared Fungal ASVs")
library(selbal)
library(phyloseq)
library(tidyverse)
library(metagMisc)
library(grid)
library(ggpubr)
renv::install("malucalle/selbal")
BiocManager::install("CMA")
renv::install("malucalle/selbal")
sessionInfo()
library(selbal)
library(phyloseq)
library(tidyverse)
library(metagMisc)
library(grid)
library(ggpubr)
library(visNetwork)
library(igraph)
library(tidyverse)
library(phyloseq)
library(tidyverse)
library(tidyverse)
library(RColorBrewer)
library(ggrepel)
renv::snapshot()
