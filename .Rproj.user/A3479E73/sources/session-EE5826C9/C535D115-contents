library(phyloseq)
library(tidyverse)


# input phyloseq and column to split on
path <- "./data/physeq_xzm_coldseep16s.rds"
physeq <- readRDS(path)

# retrieve split factors
metadata <- as.data.frame(sample_data(physeq))

metadatasplit <- metadata %>%
  split(f = as.factor(.$ROV))  %>%  # change the factor here to split on!
  lapply(., FUN = function(x){rownames(x)})



# automatic splitting and saving 
for (i in seq_along(metadatasplit)){
  physeqsub <- subset_samples(physeq, 
                              sample_names(physeq) %in% metadatasplit[[i]])
  saveRDS(physeqsub, 
          paste(str_sub(path, end=-5), "_", names(metadatasplit)[i], ".rds", sep = ""))
}

  